<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡∏≥‡πÑ‡∏¢ - ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÑ‡∏ó‡∏¢</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
  
  <!-- Leaflet JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * {
      font-family: 'Kanit', sans-serif;
    }
    
    #map {
      height: 650px;
      width: 100%;
      border-radius: 1rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }
    
    .custom-tooltip {
      background: rgba(102, 126, 234, 0.95);
      border: 2px solid white;
      border-radius: 8px;
      padding: 4px 8px;
      font-size: 10px;
      font-weight: 600;
      color: white;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      line-height: 1.3;
    }
    
    .custom-tooltip::before {
      border-top-color: rgba(102, 126, 234, 0.95) !important;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: scale(1.02);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }
    
    .input-modern {
      transition: all 0.3s ease;
    }
    
    .input-modern:focus {
      transform: scale(1.02);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }
    
    .marker-pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .toast {
      animation: slideIn 0.5s ease-out;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .stat-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
      border-left: 4px solid #667eea;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen">
  <div class="container mx-auto px-4 py-6 max-w-7xl">
    
    <!-- Header Section -->
    <div class="gradient-bg text-white rounded-2xl shadow-2xl p-8 mb-8 card-hover">
      <div class="flex items-center justify-between flex-wrap gap-4">
        <div>
          <h1 class="text-4xl font-bold mb-3 flex items-center gap-3">
            üçà ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡∏≥‡πÑ‡∏¢ ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠
          </h1>
          <p class="text-purple-100 text-lg">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡∏≥‡πÑ‡∏¢‡πÅ‡∏ö‡∏ö Real-time</p>
        </div>
        <div class="bg-white bg-opacity-20 backdrop-blur-lg rounded-xl p-4 text-right">
          <p class="text-sm text-purple-100 mb-1">‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢</p>
          <p class="font-semibold text-lg">‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏û‡∏à‡∏ô‡πå ‡∏£‡∏π‡∏õ‡πÇ‡∏™‡∏°</p>
          <p class="text-sm text-purple-200">‡∏£‡∏´‡∏±‡∏™: 6604101391</p>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="stat-card bg-white rounded-xl p-6 card-hover">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm mb-1">‡∏à‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
            <p class="text-3xl font-bold text-purple-600" id="totalMarkers">0</p>
          </div>
          <div class="text-5xl">üìç</div>
        </div>
      </div>
      
      <div class="stat-card bg-white rounded-xl p-6 card-hover">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</p>
            <p class="text-3xl font-bold text-purple-600" id="avgPrice">0.00</p>
          </div>
          <div class="text-5xl">üí∞</div>
        </div>
      </div>
      
      <div class="stat-card bg-white rounded-xl p-6 card-hover">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm mb-1">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
            <p class="text-xl font-bold text-purple-600" id="lastUpdate">-</p>
          </div>
          <div class="text-5xl">üìÖ</div>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- Form Section -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-2xl shadow-xl p-6 card-hover">
          <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
            <span class="text-3xl">‚ûï</span>
            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤
          </h2>
          
          <form id="longanForm" class="space-y-4">
            
            <!-- Province -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î *</label>
              <select id="province" required class="input-modern w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>
                <option value="‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà">‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</option>
                <option value="‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢">‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢</option>
                <option value="‡∏•‡∏≥‡∏û‡∏π‡∏ô">‡∏•‡∏≥‡∏û‡∏π‡∏ô</option>
                <option value="‡∏•‡∏≥‡∏õ‡∏≤‡∏á">‡∏•‡∏≥‡∏õ‡∏≤‡∏á</option>
                <option value="‡∏û‡∏∞‡πÄ‡∏¢‡∏≤">‡∏û‡∏∞‡πÄ‡∏¢‡∏≤</option>
                <option value="‡πÅ‡∏û‡∏£‡πà">‡πÅ‡∏û‡∏£‡πà</option>
                <option value="‡∏ô‡πà‡∏≤‡∏ô">‡∏ô‡πà‡∏≤‡∏ô</option>
                <option value="‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô">‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô</option>
              </select>
            </div>

            <!-- Place -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (‡∏ï‡∏•‡∏≤‡∏î/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠)</label>
              <input type="text" id="place" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏•‡∏≤‡∏î‡πÄ‡∏°‡∏∑‡∏≠‡∏á, ‡∏ï‡∏•‡∏≤‡∏î‡∏™‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏¢" 
                class="input-modern w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent">
            </div>

            <!-- Price -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.) *</label>
              <input type="number" id="price" step="0.01" placeholder="35.50" required
                class="input-modern w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent">
            </div>

            <!-- Date -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏£‡∏ß‡∏à *</label>
              <input type="date" id="date" required
                class="input-modern w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent">
            </div>

            <!-- Optional Coordinates -->
            <div class="bg-purple-50 rounded-xl p-4 border border-purple-200">
              <p class="text-sm font-semibold text-purple-700 mb-3">‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ (‡∏ñ‡πâ‡∏≤‡∏ó‡∏£‡∏≤‡∏ö)</p>
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label class="block text-xs text-gray-600 mb-1">Latitude</label>
                  <input type="number" id="lat" step="0.0001" placeholder="18.7883"
                    class="input-modern w-full px-3 py-2 border-2 border-purple-200 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <div>
                  <label class="block text-xs text-gray-600 mb-1">Longitude</label>
                  <input type="number" id="lng" step="0.0001" placeholder="98.9853"
                    class="input-modern w-full px-3 py-2 border-2 border-purple-200 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
              </div>
            </div>

            <button type="submit" 
              class="btn-primary w-full text-white font-bold py-4 px-6 rounded-xl shadow-lg flex items-center justify-center gap-2">
              <span class="text-xl">‚ú®</span>
              ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            </button>
          </form>

          <!-- Quick Info -->
          <div class="mt-6 bg-blue-50 border border-blue-200 rounded-xl p-4">
            <h3 class="font-bold text-blue-800 mb-2 flex items-center gap-2">
              <span>üí°</span> ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            </h3>
            <ul class="text-sm text-blue-700 space-y-1">
              <li>‚Ä¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>
              <li>‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
              <li>‚Ä¢ ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏à‡∏∏‡∏î‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Map Section -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-2xl shadow-xl p-4">
          <div class="mb-4 flex items-center justify-between">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
              <span class="text-2xl">üó∫Ô∏è</span>
              ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡∏≥‡πÑ‡∏¢
            </h2>
            <button onclick="clearAllMarkers()" 
              class="px-4 py-2 bg-red-50 hover:bg-red-100 text-red-600 font-semibold rounded-lg transition">
              üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
          </div>
          <div id="map"></div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="mt-8 text-center text-gray-600">
      <p class="text-sm">üçà Longan Price Tracking System | Developed by ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏û‡∏à‡∏ô‡πå ‡∏£‡∏π‡∏õ‡πÇ‡∏™‡∏° (6604101391)</p>
      <p class="text-xs mt-1">Powered by Leaflet.js, OpenStreetMap & Tailwind CSS</p>
    </div>

  </div>

  <script>
    // Initialize map
    const map = L.map('map').setView([18.7883, 99.0], 8);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors',
      maxZoom: 18
    }).addTo(map);

    let markers = [];
    let longanData = [];

    // Custom green icon
    const greenIcon = L.icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    // Province coordinates
    const provinceCoords = {
      '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà': [18.7883, 98.9853],
      '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢': [19.9105, 99.8406],
      '‡∏•‡∏≥‡∏û‡∏π‡∏ô': [18.5744, 99.0087],
      '‡∏•‡∏≥‡∏õ‡∏≤‡∏á': [18.2888, 99.4908],
      '‡∏û‡∏∞‡πÄ‡∏¢‡∏≤': [19.1921, 99.8995],
      '‡πÅ‡∏û‡∏£‡πà': [18.1447, 100.1403],
      '‡∏ô‡πà‡∏≤‡∏ô': [18.7838, 100.7792],
      '‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô': [19.3014, 97.9658]
    };

    // Geocoding cache
    function getGeoCache() {
      const cache = localStorage.getItem('geoCache');
      return cache ? JSON.parse(cache) : {};
    }

    function setGeoCache(key, coords) {
      const cache = getGeoCache();
      cache[key] = coords;
      localStorage.setItem('geoCache', JSON.stringify(cache));
    }

    // Geocoding function
    async function geocodeLocation(province, place) {
      const cacheKey = `${place}-${province}`;
      const cache = getGeoCache();
      
      if (cache[cacheKey]) {
        return cache[cacheKey];
      }

      try {
        const query = place ? `${place}, ${province}, Thailand` : `${province}, Thailand`;
        const response = await fetch(
          `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=1`
        );
        const data = await response.json();
        
        if (data && data.length > 0) {
          const coords = [parseFloat(data[0].lat), parseFloat(data[0].lon)];
          setGeoCache(cacheKey, coords);
          return coords;
        }
      } catch (error) {
        console.error('Geocoding error:', error);
      }

      return provinceCoords[province] || [18.7883, 99.0];
    }

    // Add marker
    function addMarker(lat, lng, data) {
      const marker = L.marker([lat, lng], { icon: greenIcon }).addTo(map);
      
      const popupContent = `
        <div class="p-3" style="font-family: 'Kanit', sans-serif; min-width: 220px;">
          <h3 class="font-bold text-purple-700 text-lg mb-3 border-b-2 border-purple-200 pb-2">
            ${data.place ? data.place + ' - ' : ''}${data.province}
          </h3>
          <div class="space-y-2 text-sm">
            <div class="flex items-center gap-2">
              <span class="text-lg">üí∞</span>
              <span class="font-semibold">‡∏£‡∏≤‡∏Ñ‡∏≤:</span> 
              <span class="text-green-600 font-bold">${data.price} ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-lg">üìÖ</span>
              <span class="font-semibold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span> 
              <span class="text-gray-700">${formatDate(data.date)}</span>
            </div>
            ${data.lat && data.lng ? `
              <div class="flex items-center gap-2 text-xs text-gray-500 mt-2 pt-2 border-t border-gray-200">
                <span>üìç</span>
                <span>${data.lat.toFixed(4)}, ${data.lng.toFixed(4)}</span>
              </div>
            ` : ''}
          </div>
          <div class="mt-3 pt-2 border-t border-purple-100 text-xs text-purple-600 text-center">
            <div>‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏û‡∏à‡∏ô‡πå ‡∏£‡∏π‡∏õ‡πÇ‡∏™‡∏°</div>
            <div class="text-purple-500">‡∏£‡∏´‡∏±‡∏™ 6604101391</div>
          </div>
        </div>
      `;
      
      marker.bindPopup(popupContent);
      
      // Add permanent label
      marker.bindTooltip('‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏û‡∏à‡∏ô‡πå ‡∏£‡∏π‡∏õ‡πÇ‡∏™‡∏°<br>6604101391', {
        permanent: true,
        direction: 'top',
        className: 'custom-tooltip',
        offset: [0, -35]
      });
      
      markers.push(marker);
      
      return marker;
    }

    // Format date
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('th-TH', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
    }

    // Fit map to markers
    function fitMapToMarkers() {
      if (markers.length > 0) {
        const group = L.featureGroup(markers);
        map.fitBounds(group.getBounds().pad(0.1));
      }
    }

    // Update statistics
    function updateStats() {
      document.getElementById('totalMarkers').textContent = longanData.length;
      
      if (longanData.length > 0) {
        const avg = longanData.reduce((sum, d) => sum + d.price, 0) / longanData.length;
        document.getElementById('avgPrice').textContent = avg.toFixed(2) + ' ‡∏ø';
        
        const lastDate = longanData[longanData.length - 1].date;
        document.getElementById('lastUpdate').textContent = new Date(lastDate).toLocaleDateString('th-TH', {
          day: 'numeric',
          month: 'short'
        });
      }
    }

    // Clear all markers
    function clearAllMarkers() {
      if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        markers.forEach(m => map.removeLayer(m));
        markers = [];
        longanData = [];
        updateStats();
        showMessage('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'info');
      }
    }

    // Show message
    function showMessage(text, type = 'success') {
      const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        info: 'bg-blue-500'
      };
      
      const div = document.createElement('div');
      div.className = `toast fixed top-4 right-4 ${colors[type]} text-white px-6 py-4 rounded-xl shadow-2xl z-50 font-semibold`;
      div.textContent = text;
      document.body.appendChild(div);
      
      setTimeout(() => {
        div.style.opacity = '0';
        div.style.transform = 'translateX(400px)';
        setTimeout(() => div.remove(), 500);
      }, 3000);
    }

    // Form submission
    document.getElementById('longanForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const province = document.getElementById('province').value;
      const place = document.getElementById('place').value;
      const price = document.getElementById('price').value;
      const date = document.getElementById('date').value;
      let lat = parseFloat(document.getElementById('lat').value);
      let lng = parseFloat(document.getElementById('lng').value);

      if (!province) {
        showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î', 'error');
        return;
      }

      // Show loading
      const submitBtn = this.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<span class="animate-spin">‚è≥</span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
      submitBtn.disabled = true;

      try {
        // Get coordinates
        if (!lat || !lng) {
          const coords = await geocodeLocation(province, place);
          lat = coords[0];
          lng = coords[1];
        }

        const data = {
          province,
          place,
          price: parseFloat(price),
          date,
          lat,
          lng,
          timestamp: new Date().toISOString()
        };

        longanData.push(data);
        const marker = addMarker(lat, lng, data);
        marker.openPopup();
        fitMapToMarkers();
        updateStats();

        this.reset();
        document.getElementById('date').valueAsDate = new Date();

        showMessage('‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
      } catch (error) {
        showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
      } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    });

    // Initialize sample data
    function initSampleData() {
      const samples = [
        { province: '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà', place: '‡∏ï‡∏•‡∏≤‡∏î‡πÄ‡∏°‡∏∑‡∏≠‡∏á', price: 35.50, date: '2024-11-25', lat: 18.7883, lng: 98.9853 },
        { province: '‡∏•‡∏≥‡∏û‡∏π‡∏ô', place: '‡∏ï‡∏•‡∏≤‡∏î‡∏™‡∏î', price: 32.00, date: '2024-11-26', lat: 18.5744, lng: 99.0087 },
        { province: '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢', place: '‡∏ï‡∏•‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á', price: 38.00, date: '2024-11-27', lat: 19.9105, lng: 99.8406 }
      ];

      samples.forEach(data => {
        longanData.push(data);
        addMarker(data.lat, data.lng, data);
      });

      fitMapToMarkers();
      updateStats();
    }

    // Initialize
    document.getElementById('date').valueAsDate = new Date();
    initSampleData();
  </script>
</body>
</html>